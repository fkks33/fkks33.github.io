<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出発便フライト情報</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #121212;
            color: #f1f1f1;
            margin: 0;
            padding: 20px;
        }
        #flight-board {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            border-collapse: collapse;
            background-color: #2a2a2a;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #444;
        }
        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #444;
        }
        thead {
            background-color: #1f1f1f;
            color: #ffffff;
            font-size: 1.1em;
        }
        tbody tr { background-color: #2a2a2a; }
        tbody tr:nth-child(even) { background-color: #3c3c3c; }
        tbody tr:hover { background-color: #555; }
        
        /* ★★★ プルダウンメニュー用のスタイルを追加 ★★★ */
        #selector-container {
            text-align: center;
            margin: 30px auto;
            max-width: 800px;
        }
        #airport-selector {
            padding: 8px 12px;
            font-size: 1em;
            border-radius: 5px;
            background-color: #3c3c3c;
            color: #f1f1f1;
            border: 1px solid #555;
        }
    </style>
</head>
<body>
    
    <table id="flight-board">
        <thead>
            <tr>
                <th>便名</th>
                <th>行先</th>
                <th>定刻</th>
                <th>変更時刻</th>
                <th>搭乗口</th>
                <th>備考</th>
            </tr>
        </thead>
        <tbody id="flight-data">
        </tbody>
    </table>

    <div id="selector-container">
        <label for="airport-selector">出発空港を選択: </label>
        <select id="airport-selector">
            <option value="ITM" selected>伊丹 (ITM)</option>
            <option value="NRT">成田 (NRT)</option>
            <option value="HND">羽田 (HND)</option>
            <option value="FUK">福岡 (FUK)</option>
            <option value="KIX">関西 (KIX)</option>
            <option value="KMJ">熊本 (KMJ)</option>
        </select>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const flightDataBody = document.getElementById('flight-data');
            const airportSelector = document.getElementById('airport-selector');

            // ★★★ 2. データ取得処理を関数化 ★★★
            const fetchFlightData = (airportIata) => {
                // 新しいデータを読み込む前に「読み込み中...」の表示を出す
                flightDataBody.innerHTML = `<tr><td colspan="6">読み込み中...</td></tr>`;

                const apiUrl = `http://api.aviationstack.com/v1/flights?access_key=2f2b359ffbeb4e3db8fe82ca90f64637&dep_iata=${airportIata}`;

                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('ネットワークの応答が正しくありませんでした。');
                        }
                        return response.json();
                    })
                    .then(apiData => {
                        // テーブルをクリア
                        flightDataBody.innerHTML = '';
                        const flights = apiData.data;

                        if (!flights || flights.length === 0) {
                            flightDataBody.innerHTML = '<tr><td colspan="6">現在、表示できるフライト情報がありません。</td></tr>';
                            return;
                        }
                        
                        flights.sort((a, b) => new Date(a.departure.scheduled) - new Date(b.departure.scheduled));

                        flights.forEach(flight => {
                            // ... (ここから下のデータ処理部分は変更なし) ...
                            const flightNumber = flight.flight.iata ?? '---';
                            const destination = flight.arrival.airport ?? '---';
                            const gate = flight.departure.gate ?? '---';
                            
                            const timeFormatOptions = { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' };
                            const scheduledTime = new Date(flight.departure.scheduled).toLocaleTimeString('ja-JP', timeFormatOptions);

                            let changedTimeText = '---';
                            const delayMinutes = flight.departure.delay;
                            if (delayMinutes && typeof delayMinutes === 'number') {
                                const scheduledDate = new Date(flight.departure.scheduled);
                                scheduledDate.setMinutes(scheduledDate.getMinutes() + delayMinutes);
                                changedTimeText = scheduledDate.toLocaleTimeString('ja-JP', timeFormatOptions);
                            }

                            const remarksParts = [];
                            if (flight.flight.codeshared !== null) {
                                remarksParts.push('共同運行便');
                            }
                            if (flight.flight_status === 'landed') {
                                remarksParts.push('出発済み');
                            }
                            const remarksText = remarksParts.join(' ') || '---';

                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${flightNumber}</td>
                                <td>${destination}</td>
                                <td>${scheduledTime}</td>
                                <td>${changedTimeText}</td>
                                <td>${gate}</td>
                                <td>${remarksText}</td>
                            `;
                            flightDataBody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('データの取得に失敗
